<h2>Grade Entry for <%= @assignment.name %></h2>

<%= form_tag editor_grades_path, :method => :get do %>
  <p>
    <%= label_tag :assignment_id, 'Switch assignment' %>
    <%= select_tag :assignment_id,
          options_for_select(Course.main.assignments.order('deadline DESC').map { |a| [a.name, a.id] }, @assignment.id)
    %>
    <%= submit_tag "Switch" %>
	</p>
<% end %>

<section class="grades-table-container">
  <table class="grades-table">
    <thead>
      <tr>
        <th scope="col">
          <%= search_field_tag :name, '', :placeholder => 'name filter' %>
        </th>
        <% @metrics.each do |metric| %>
        <th data-metric-id="<%= metric.id %>">
          <%= metric.name %>
        </th>
        <% end %>
        <th>
          Total
        </th>
      </tr>
    </thead>
    <tbody>
      <% @subjects.each do |subject| %>
      <tr data-subject-name="<%= subject.name %>"
          data-subject-id="<%= subject.to_param %>"
          data-subject-type="<%= subject.class.name %>">
        <th class="subject-name" scope="row">
          <%= link_to subject.name, subject, :tabindex => '-1' %>
        </th>
        <% @metrics.each do |metric| %>
        <td class="grade" data-metric-id="<%= metric.id %>">
          <%= render 'grades/individual_form', :grade => (@grades[[subject, metric]] || [Grade.new(:subject => subject, :metric => metric)]).first %>
        </td>
        <% end %>
        <td class="summary">
          <span class="grade-sum"></span>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>
</section>
