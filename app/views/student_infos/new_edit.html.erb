<!-- student_infos/new_edit -->
<div class="full_section">
	
<h1 class="full_section">Student Information Form for <%= @s_user.name %></h1>

<%= error_messages_for :student_info %>

<%
if @student_info.new_record?
	url = {:controller => :student_infos, :action => @manual ? :create_manual : :create}
	url[:id] = 0 if @manual
else
	url = {:controller => :student_infos, :action => :update, :id => @student_info.id}
end
%>

<% form_for(@student_info, :url => url, :html => {:class => 'student_form'}) do |f| %>
	<div class="form_box">
		<div class="form_entry">
			<div class="form_label">Taking <%= Course.main.number %> for credit</div>
			<div class="form_field_box">
				<%= f.check_box :wants_credit, :class => 'form_field' %>Yes
			</div>
		</div>
		<div class="form_entry">
			<div class="form_label">(recitation allocation)<br />Enter the classes you are taking on Wednesday and Friday</div>
			<div class="form_field_box">
				<table>
					<thead>
						<tr>
							<td>Time</td>
							<% ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'].zip((0...5).to_a).each do |day, dday| %>
								<td><%= day %></td>
							<% end %>
						</tr>						
					</thead>
					<tbody>
						<% ['10am', '11am', '12pm', '1pm', '2pm', '3pm', '4pm'].zip((10..16).to_a).each do |hour, dhour| %>
							<tr>
								<td><%= hour %></td>
								<% (0...5).each do |day| %>
									<td>
										<% timeslot = day + dhour * 10
											if @recitation_conflicts.has_key? timeslot
												prefix = 'old_recitation_conflicts[]'
												obj = @recitation_conflicts[timeslot]
											else
												prefix = 'recitation_conflicts[]'
												obj = RecitationConflict.new(:timeslot => timeslot)
											end
										fields_for(prefix, obj) do |r|  %>
											<%= r.text_field :class_name, :class => 'form_field', :id => "recitation_conflicts_#{timeslot}_class_name", :size => 8 %>
											<%= r.hidden_field :timeslot, :id => "recitation_conflicts_#{timeslot}_timeslot" %>
										<% end %>
									</td>
								<% end %>
							</tr>
						<% end %>						
					</tbody>
				</table>
			</div>			
		</div>
		
		<div class="form_entry">
			<div class="form_label">Have you taken</div>
			<div class="form_field_box">
				<div id="prereq_inject_target"></div>
			</div>
		</div>
		
    <% f.fields_for :prerequisite_answers do |p| %>
    <div class="form_entry">
      <div class="form_label"><%= p.object.prerequisite.waiver_question %></div>
      <div class="form_field_box">
      <%= p.text_area :waiver_answer, :rows => 3, :class => 'form_field' %>
      </div>
			<span class="prereq_inject">
        <%= p.check_box :took_course, :class => 'prereq_inject_trigger' %>
        <%= p.object.prerequisite.course_number %>        
				<%= p.hidden_field :prerequisite_id %>
			</span>
		</div>
		<% object_prefix = p.object_name.gsub(/\[|\]/, '_').gsub('__', '_') %>
		<script type="text/javascript">
			var masterDiv = $('<%= object_prefix %>waiver_answer').up('.form_entry');
			var injectSpan = masterDiv.down('.prereq_inject');
			var targetDiv = $('prereq_inject_target');
			injectSpan.up().removeChild(injectSpan);
			targetDiv.appendChild(injectSpan);
			
      show_div_on_checkbox_setting(masterDiv,
			     injectSpan.down('.prereq_inject_trigger'), false);
		</script>
    <% end %>
							
		<div class="form_entry">
			<div class="form_label">Other comments / questions</div>
			<div class="form_field_box">
				<%= f.text_area :comments, :rows => 5, :class => 'form_field' %>
			</div>
		</div>
		<div class="form_submit_box">
		    <%= f.submit @student_info.new_record? ? "Submit" : "Update", :class => 'form_submit' %>
			or
			<%= link_to 'Go home', :controller => :welcome, :action => :home %>
		</div>
	</div>
<% end %>

</div>
