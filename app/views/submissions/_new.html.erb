<%= form_for(Submission.new, :html => {:multipart => true,
        :class => 'new-submission-form'}) do |f| %>
  <dl>
  	<dt><%= f.label :deliverable_id, 'Deliverable' %></dt>
		<dd>
		  <%= f.select :deliverable_id,
		               Deliverable.where(@s_user.admin ? {:published => true} : {}).
		                           order('id DESC').
		                           map {|d| ["#{d.assignment.name} : #{d.name}", d.id]},
		               :include_blank => '(pick one)' %>
		</dd>
		<dt>Instructions</dt>
		<dd id="submission_description_text">
	    Select a deliverable for instructions.
		</dd>
		<dt><%= f.label :code, 'File' %></dt>
		<dd>
		  <%= f.file_field :code %>
		  <%= f.submit "Submit" %>			
		</dd>
  </dl>
	
	<%= observe_field 'submission_deliverable_id', :frequency => 0.5, :update => 'submission_description_text',
			:before => update_page { |p| p.replace_html 'submission_description_text', 'loading...' },
			:url => xhr_description_deliverables_path,
			:with => "'deliverable_id=' + encodeURIComponent(value)" %>					
		
  <%= javascript_tag <<JS_END		
$('submission_submit').observe('click', function(event) {
	if($('submission_deliverable_id').value == '') {
		alert("You need to tell me what you're submitting for");
		event.stop();
	}
	else if ($('submission_code').value == '') {
		alert('You need to give me a file to work with');
		event.stop();
	}
});
JS_END
  %>
<% end %>
