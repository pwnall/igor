<h2>Submissions</h2>

<%= form_tag submissions_path(course_id: current_course), method: :get do %>
  <p>
    <%= label_tag :deliverable_id do %>
      Deliverable
    <% end %>
    <%= select_tag :deliverable_id, options_for_select(
          @deliverables.map { |d| [d.assignment.name + ': ' + d.name, d.id] },
          nil) %>
    <%= button_tag type: :submit do %>
      <%= filter_icon_tag %> Filter by deliverable
    <% end %>
  </p>
<% end %>

<%= form_tag submissions_path(course_id: current_course), method: :get do %>
  <p>
    <%= label_tag :assignment_id do %>
      Assignment
    <% end %>
    <%= select_tag :assignment_id, options_for_select(
          @assignments.map { |a| [a.name, a.id] }, nil) %>
    <%= button_tag type: :submit do %>
      <%= filter_icon_tag %> Filter by assignment
    <% end %>
  </p>
<% end %>

<table>
  <thead>
    <tr>
      <td>Deliverable</td>
      <td>Student</td>
      <td>Submitted</td>
      <td>IP</td>
      <td>Status</td>
    </tr>
  </thead>
  <tbody>
    <% @submissions.each do |submission| %>
    <tr>
      <td>
        <%= link_to assignment_path(submission.assignment,
                                    course_id: submission.course) do %>
          <%= submission.assignment.name %>: <%= submission.deliverable.name %>
        <% end %>
      </td>
      <td><%= submission.subject.name %></td>
      <td title="<%=h submission.updated_at %>">
        <%= (submission.updated_at < submission.deliverable.assignment.due_at) ? 'on time' : "late by #{distance_of_time_in_words(submission.deliverable.assignment.due_at, submission.updated_at)}" %>
      </td>
      <td>
        <%= submission.upload_ip %>
      </td>
      <td>
        <% if submission.analysis %>
        <%= link_to analysis_status_text(submission.analysis),
              analysis_path(submission.analysis, course_id: submission.course) %>
        <% else %>
        no status
        <% end %>
      </td>
      <td>
        <%= button_to reanalyze_submission_path(submission,
              course_id: submission.course), method: :post do %>
          <%= recompute_icon_tag %> Re-analyze
        <% end %>
      </td>
      <td>
        <%= link_to file_submission_path(submission,
              course_id: submission.course), class: 'button' do %>
          <%= download_icon_tag %> Download
        <% end %>
      </td>
    </tr>
    <% end %>
  </tbody>
  <tfoot>
    <tr>
      <td colspan="5">
        <%= @submissions.length %> total submissions
      </td>
    </tr>
  </tfoot>
</table>
